- hosts: beast
  roles:
    - dokku_bot.ansible_dokku
  vars:
      # If you are running dokku on a small VPS, you'll most likely
      # need some swap to ensure you don't run out of RAM during deploys
      swap_file_size_mb: '2048'
      dokku_version: 0.34.6
      dokku_hostname: "brntgarlic.com"
      # dokku_users:
      #   - name: ansible
      #     username: ansible
      #     ssh_key: "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHOsrE1/XgrhLQwSoOhhEfYku1ONHrOnAfnG7I6Ik/8k"
      dokku_plugins:
        - name: clone
          url: https://github.com/crisward/dokku-clone.git
        - name: letsencrypt
          url: https://github.com/dokku/dokku-letsencrypt.git
        - name: postgres
          url: https://github.com/dokku/dokku-postgres.git
        - name: redis
          url: https://github.com/dokku/dokku-redis.git
        - name: tailscale
          url: https://github.com/andrew-womeldorf/dokku-tailscale.git
  tasks:
    - name: Setup tailscale oauth key
      shell: dokku config:set --global TS_AUTHKEY={{lookup('community.general.onepassword', 'tailscale:dokku', field='password', vault='Infra Secrets')}}
